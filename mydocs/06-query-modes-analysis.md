# LightRAG æŸ¥è¯¢æ¨¡å¼æ·±åº¦è§£æ

## æ¦‚è¿°

LightRAG æä¾›äº† 6 ç§ä¸åŒçš„æŸ¥è¯¢æ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼éƒ½æœ‰å…¶ç‹¬ç‰¹çš„æ£€ç´¢ç­–ç•¥å’Œé€‚ç”¨åœºæ™¯ã€‚æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº†æ¯ç§æ¨¡å¼çš„å·¥ä½œåŸç†ã€æ€§èƒ½ç‰¹ç‚¹å’Œæœ€ä½³ä½¿ç”¨åœºæ™¯ã€‚

## ğŸ¤– æ¨¡å‹ä½¿ç”¨æ¶æ„

### ç»Ÿä¸€LLMæ¨¡å‹ç­–ç•¥

LightRAGä½¿ç”¨**ç»Ÿä¸€çš„LLMæ¨¡å‹**æ¥å¤„ç†ä¸åŒçš„ä»»åŠ¡ï¼Œé€šè¿‡ä¸åŒçš„æç¤ºè¯å’Œå‚æ•°å®ç°åŠŸèƒ½åˆ†åŒ–ï¼š

#### æ¨¡å‹é€‰æ‹©ä¼˜å…ˆçº§
```
query_param.model_func > query_llm_func > llm_model_func
```

#### ä»»åŠ¡åˆ†å·¥
- **å…³é”®è¯æå–**: ä½¿ç”¨LLMè¿›è¡ŒåŒå±‚å…³é”®è¯æå–ï¼ˆé«˜çº§/ä½çº§å…³é”®è¯ï¼‰
- **æŸ¥è¯¢ç”Ÿæˆ**: åŸºäºå…³é”®è¯æ„å»ºæŸ¥è¯¢ä¸Šä¸‹æ–‡
- **å“åº”ç”Ÿæˆ**: åŸºäºæ£€ç´¢ç»“æœç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
- **ä¼˜å…ˆçº§è®¾ç½®**: æŸ¥è¯¢ä»»åŠ¡è®¾ç½®ä¸ºä¼˜å…ˆçº§5-8ï¼Œç¡®ä¿èµ„æºä¼˜å…ˆåˆ†é…

## ğŸ“Š å…­ç§æŸ¥è¯¢æ¨¡å¼è¯¦è§£

### 1. Naiveæ¨¡å¼ - çº¯å‘é‡æ£€ç´¢

**ç‰¹ç‚¹**: æœ€ç®€å•å¿«é€Ÿçš„æ£€ç´¢æ–¹å¼ï¼Œä¸ä½¿ç”¨çŸ¥è¯†å›¾è°±

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢ â†’ å‘é‡ç›¸ä¼¼åº¦æœç´¢ â†’ æ–‡æ¡£å—æ£€ç´¢ â†’ LLMç”Ÿæˆå“åº”
```

**æŠ€æœ¯å®ç°**:
- ç›´æ¥è°ƒç”¨ `chunks_vdb.query()` è¿›è¡Œå‘é‡æœç´¢
- ä½¿ç”¨ `chunk_top_k` æˆ– `top_k` å‚æ•°æ§åˆ¶æ£€ç´¢æ•°é‡
- ä¸è¿›è¡Œå…³é”®è¯æå–å’Œå›¾è°±æŸ¥è¯¢

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´: ~0.8s
- å‡†ç¡®ç‡: 72%
- èµ„æºæ¶ˆè€—: æœ€ä½

**é€‚ç”¨åœºæ™¯**:
- ç®€å•äº‹å®æŸ¥è¯¢
- å¿«é€ŸåŸå‹éªŒè¯
- èµ„æºå—é™ç¯å¢ƒ

### 2. Localæ¨¡å¼ - å±€éƒ¨å®ä½“æ£€ç´¢

**ç‰¹ç‚¹**: åŸºäºå®ä½“é‚»åŸŸçš„å±€éƒ¨æ¨ç†

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢ â†’ LLMæå–ä½çº§å…³é”®è¯ â†’ å®ä½“å‘é‡æœç´¢ â†’ å›¾è°±é‚»åŸŸæŸ¥è¯¢ â†’ æ„å»ºå±€éƒ¨ä¸Šä¸‹æ–‡ â†’ LLMç”Ÿæˆå“åº”
```

**æŠ€æœ¯å®ç°**:
- ä½¿ç”¨ `get_keywords_from_query()` æå– `ll_keywords`
- è°ƒç”¨ `_get_node_data()` è¿›è¡Œå®ä½“æ£€ç´¢
- ä½¿ç”¨ `knowledge_graph_inst.get_nodes_batch()` è·å–å®ä½“è¯¦æƒ…
- é€šè¿‡ `node_degrees_batch()` è®¡ç®—å®ä½“é‡è¦æ€§

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´: ~1.2s
- å‡†ç¡®ç‡: 78%
- èµ„æºæ¶ˆè€—: ä¸­ç­‰

**é€‚ç”¨åœºæ™¯**:
- ç‰¹å®šä¸»é¢˜çš„æ·±åº¦æŸ¥è¯¢
- å®ä½“å…³ç³»åˆ†æ
- å±€éƒ¨çŸ¥è¯†æ¢ç´¢

### 3. Globalæ¨¡å¼ - å…¨å±€å…³ç³»æ£€ç´¢

**ç‰¹ç‚¹**: åŸºäºå…¨å±€å…³ç³»ç½‘ç»œçš„æ¨ç†

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢ â†’ LLMæå–é«˜çº§å…³é”®è¯ â†’ å…³ç³»å‘é‡æœç´¢ â†’ å›¾è°±å…³ç³»æŸ¥è¯¢ â†’ æ„å»ºå…¨å±€ä¸Šä¸‹æ–‡ â†’ LLMç”Ÿæˆå“åº”
```

**æŠ€æœ¯å®ç°**:
- ä½¿ç”¨ `get_keywords_from_query()` æå– `hl_keywords`
- è°ƒç”¨ `_get_edge_data()` è¿›è¡Œå…³ç³»æ£€ç´¢
- ä½¿ç”¨ `relationships_vdb.query()` æœç´¢ç›¸å…³å…³ç³»
- é€šè¿‡å›¾è°±æŸ¥è¯¢è·å–å…³ç³»ç½‘ç»œ

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´: ~2.1s
- å‡†ç¡®ç‡: 82%
- èµ„æºæ¶ˆè€—: ä¸­é«˜

**é€‚ç”¨åœºæ™¯**:
- æ¦‚å¿µæ€§æŸ¥è¯¢
- æŠ½è±¡å…³ç³»åˆ†æ
- å…¨å±€çŸ¥è¯†æ¨ç†

### 4. Hybridæ¨¡å¼ - æ··åˆæ£€ç´¢

**ç‰¹ç‚¹**: ç»“åˆLocalå’ŒGlobalçš„ä¼˜åŠ¿

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢ â†’ LLMæå–åŒå±‚å…³é”®è¯ â†’ å¹¶è¡Œæ‰§è¡ŒLocal+Global â†’ åˆå¹¶ä¸Šä¸‹æ–‡ â†’ ç»Ÿä¸€æ’åº â†’ LLMç”Ÿæˆå“åº”
```

**æŠ€æœ¯å®ç°**:
- åŒæ—¶æå– `hl_keywords` å’Œ `ll_keywords`
- å¹¶è¡Œè°ƒç”¨ `_get_node_data()` å’Œ `_get_edge_data()`
- ä½¿ç”¨ `process_chunks_unified()` ç»Ÿä¸€å¤„ç†å’Œæ’åº
- æ™ºèƒ½åˆå¹¶å®ä½“å’Œå…³ç³»ä¸Šä¸‹æ–‡

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´: ~1.8s
- å‡†ç¡®ç‡: 85%
- èµ„æºæ¶ˆè€—: ä¸­é«˜

**é€‚ç”¨åœºæ™¯**:
- å¹³è¡¡æ€§èƒ½å’Œå‡†ç¡®æ€§çš„æŸ¥è¯¢
- å¤åˆå‹é—®é¢˜
- é€šç”¨æŸ¥è¯¢åœºæ™¯

### 5. Mixæ¨¡å¼ - å›¾è°±+å‘é‡èåˆ

**ç‰¹ç‚¹**: æœ€å…¨é¢çš„æ£€ç´¢ç­–ç•¥ï¼Œèåˆæ‰€æœ‰æ£€ç´¢æ–¹å¼

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢ â†’ LLMæå–åŒå±‚å…³é”®è¯ â†’ ä¸‰è·¯å¹¶è¡Œæ£€ç´¢ â†’ èåˆæ‰€æœ‰ä¸Šä¸‹æ–‡ â†’ é‡æ’åº â†’ LLMç”Ÿæˆå“åº”
```

**æŠ€æœ¯å®ç°**:
- ä¸‰è·¯å¹¶è¡Œæ£€ç´¢ï¼š
  - å‘é‡æ£€ç´¢: `_get_vector_context()`
  - å®ä½“æ£€ç´¢: `_get_node_data()`
  - å…³ç³»æ£€ç´¢: `_get_edge_data()`
- ä½¿ç”¨ç»Ÿä¸€çš„ä¸Šä¸‹æ–‡å¤„ç†ç®¡é“
- æ”¯æŒé‡æ’åºä¼˜åŒ–

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´: ~2.5s
- å‡†ç¡®ç‡: 88%
- èµ„æºæ¶ˆè€—: æœ€é«˜

**é€‚ç”¨åœºæ™¯**:
- å¤æ‚æ¨ç†æŸ¥è¯¢
- é«˜ç²¾åº¦è¦æ±‚
- å¤šç»´åº¦ä¿¡æ¯æ•´åˆ

### 6. Bypassæ¨¡å¼ - ç›´æ¥LLMè°ƒç”¨

**ç‰¹ç‚¹**: ç»•è¿‡æ‰€æœ‰æ£€ç´¢æœºåˆ¶ï¼Œç›´æ¥ä½¿ç”¨LLM

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢ â†’ ç›´æ¥LLMè°ƒç”¨ â†’ è¿”å›å“åº”
```

**æŠ€æœ¯å®ç°**:
- ä¸è¿›è¡Œä»»ä½•çŸ¥è¯†æ£€ç´¢
- ç›´æ¥è°ƒç”¨ `llm_model_func`
- æ”¯æŒå¯¹è¯å†å²ä¼ é€’
- è®¾ç½®æœ€é«˜ä¼˜å…ˆçº§(8)

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´: æœ€å¿«
- å‡†ç¡®ç‡: ä¾èµ–LLMæœ¬èº«çŸ¥è¯†
- èµ„æºæ¶ˆè€—: æœ€ä½

**é€‚ç”¨åœºæ™¯**:
- é€šç”¨å¯¹è¯
- ä¸éœ€è¦ç‰¹å®šçŸ¥è¯†çš„æŸ¥è¯¢
- è°ƒè¯•å’Œæµ‹è¯•
- ä¸æ™®é€šLLMå¯¹è¯

## ğŸ§  æ™ºèƒ½è‡ªé€‚åº”æœºåˆ¶

### æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢
LightRAGå…·æœ‰æ™ºèƒ½çš„æ¨¡å¼è‡ªé€‚åº”èƒ½åŠ›ï¼š

```python
# å…³é”®è¯ç¼ºå¤±å¤„ç†
if not ll_keywords and mode in ["local", "hybrid"]:
    mode = "global"  # è‡ªåŠ¨åˆ‡æ¢åˆ°globalæ¨¡å¼
    
if not hl_keywords and mode in ["global", "hybrid"]:
    mode = "local"   # è‡ªåŠ¨åˆ‡æ¢åˆ°localæ¨¡å¼
```

### ç¼“å­˜ä¼˜åŒ–
- åŸºäºæŸ¥è¯¢å‚æ•°å“ˆå¸Œçš„æ™ºèƒ½ç¼“å­˜
- æ”¯æŒå…³é”®è¯çº§åˆ«å’ŒæŸ¥è¯¢çº§åˆ«çš„ç¼“å­˜
- è‡ªåŠ¨ç¼“å­˜å¤±æ•ˆå’Œæ›´æ–°æœºåˆ¶

### Tokenç®¡ç†
- åŠ¨æ€è®¡ç®—å¯ç”¨Tokenæ•°é‡
- æ™ºèƒ½æˆªæ–­å’Œé‡æ’åºæœºåˆ¶
- ä¸Šä¸‹æ–‡é•¿åº¦è‡ªé€‚åº”è°ƒæ•´

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”ä¸é€‰æ‹©æŒ‡å—

| æ¨¡å¼ | æ£€ç´¢æ–¹å¼ | å“åº”æ—¶é—´ | å‡†ç¡®ç‡ | èµ„æºæ¶ˆè€— | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|--------|----------|----------|
| **Naive** | çº¯å‘é‡ | 0.8s | 72% | ä½ | ç®€å•äº‹å®æŸ¥è¯¢ |
| **Local** | å®ä½“é‚»åŸŸ | 1.2s | 78% | ä¸­ | ç‰¹å®šä¸»é¢˜æŸ¥è¯¢ |
| **Global** | å…³ç³»ç½‘ç»œ | 2.1s | 82% | ä¸­é«˜ | æ¦‚å¿µæ€§æŸ¥è¯¢ |
| **Hybrid** | å®ä½“+å…³ç³» | 1.8s | 85% | ä¸­é«˜ | å¹³è¡¡æ€§æŸ¥è¯¢ |
| **Mix** | å›¾è°±+å‘é‡ | 2.5s | 88% | é«˜ | å¤æ‚æ¨ç†æŸ¥è¯¢ |
| **Bypass** | ç›´æ¥LLM | æœ€å¿« | ä¾èµ–LLM | æœ€ä½ | é€šç”¨å¯¹è¯ |

## ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨
```python
from lightrag import LightRAG, QueryParam

# ä¸åŒæ¨¡å¼çš„æŸ¥è¯¢ç¤ºä¾‹
modes = ["naive", "local", "global", "hybrid", "mix", "bypass"]

for mode in modes:
    result = rag.query(
        "è§£é‡Šäººå·¥æ™ºèƒ½çš„å‘å±•å†ç¨‹",
        param=QueryParam(mode=mode)
    )
    print(f"{mode.upper()} æ¨¡å¼ç»“æœ: {result[:100]}...")
```

### é«˜çº§é…ç½®
```python
# é’ˆå¯¹ä¸åŒæŸ¥è¯¢ç±»å‹çš„ä¼˜åŒ–é…ç½®
def get_optimal_mode(query_type: str) -> QueryParam:
    if query_type == "fact":
        return QueryParam(mode="naive", top_k=5)
    elif query_type == "entity":
        return QueryParam(mode="local", top_k=10)
    elif query_type == "concept":
        return QueryParam(mode="global", top_k=8)
    elif query_type == "complex":
        return QueryParam(mode="mix", top_k=15)
    elif query_type == "chat":
        return QueryParam(mode="bypass")
    else:
        return QueryParam(mode="hybrid", top_k=10)
```

### APIå‰ç¼€ä½¿ç”¨
```python
# åœ¨APIä¸­ä½¿ç”¨æŸ¥è¯¢å‰ç¼€
queries = [
    "/naive ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ",
    "/local ä»‹ç»ä¸€ä¸‹æ·±åº¦å­¦ä¹ çš„æ¦‚å¿µ",
    "/global äººå·¥æ™ºèƒ½çš„å‘å±•è¶‹åŠ¿å¦‚ä½•ï¼Ÿ",
    "/hybrid æ¯”è¾ƒä¸åŒçš„æœºå™¨å­¦ä¹ ç®—æ³•",
    "/mix è¯¦ç»†åˆ†æç¥ç»ç½‘ç»œçš„å·¥ä½œåŸç†",
    "/bypass ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
]

for query in queries:
    # APIä¼šè‡ªåŠ¨è§£æå‰ç¼€å¹¶é€‰æ‹©å¯¹åº”æ¨¡å¼
    result = api_query(query)
    print(f"æŸ¥è¯¢: {query}")
    print(f"ç»“æœ: {result[:100]}...\n")
```

## ğŸ”§ æœ€ä½³å®è·µ

### 1. æ¨¡å¼é€‰æ‹©ç­–ç•¥
- **Naiveæ¨¡å¼**: ç®€å•äº‹å®æŸ¥è¯¢ï¼Œéœ€è¦å¿«é€Ÿå“åº”
- **Localæ¨¡å¼**: å®ä½“ç›¸å…³æŸ¥è¯¢ï¼Œç‰¹å®šä¸»é¢˜æ·±åº¦åˆ†æ
- **Globalæ¨¡å¼**: æ¦‚å¿µåˆ†æï¼ŒæŠ½è±¡å…³ç³»æ¨ç†
- **Hybridæ¨¡å¼**: é€šç”¨æŸ¥è¯¢ï¼Œå¹³è¡¡æ€§èƒ½å’Œå‡†ç¡®æ€§
- **Mixæ¨¡å¼**: å¤æ‚æ¨ç†æŸ¥è¯¢ï¼Œé«˜ç²¾åº¦éœ€æ±‚
- **Bypassæ¨¡å¼**: æ™®é€šå¯¹è¯ï¼Œä¸éœ€è¦çŸ¥è¯†æ£€ç´¢çš„åœºæ™¯

### 2. æ€§èƒ½ä¼˜åŒ–å»ºè®®
- **å‚æ•°è°ƒä¼˜**: åˆç†è®¾ç½® `top_k`ã€`chunk_top_k` å‚æ•°
- **ç¼“å­˜ç­–ç•¥**: å¯ç”¨æŸ¥è¯¢ç¼“å­˜å’Œå…³é”®è¯ç¼“å­˜
- **é‡æ’åº**: ä½¿ç”¨é‡æ’åºæ¨¡å‹ä¼˜åŒ–ç»“æœè´¨é‡
- **Tokenç®¡ç†**: ç›‘æ§Tokenä½¿ç”¨ï¼Œé¿å…è¶…é™

### 3. é”™è¯¯å¤„ç†ä¸ç›‘æ§
- **æ¨¡å¼åˆ‡æ¢**: ç›‘æ§è‡ªåŠ¨æ¨¡å¼åˆ‡æ¢æ—¥å¿—
- **å…³é”®è¯æå–**: å¤„ç†å…³é”®è¯æå–å¤±è´¥çš„é™çº§ç­–ç•¥
- **æ€§èƒ½ç›‘æ§**: è·Ÿè¸ªå“åº”æ—¶é—´å’Œå‡†ç¡®ç‡æŒ‡æ ‡
- **èµ„æºç®¡ç†**: ç›‘æ§å†…å­˜å’ŒAPIè°ƒç”¨æ¬¡æ•°

### 4. å®é™…åº”ç”¨åœºæ™¯
```python
# æ™ºèƒ½å®¢æœç³»ç»Ÿ
def smart_customer_service(query: str, context: str = None):
    if "ä½ å¥½" in query or "è°¢è°¢" in query:
        return rag.query(query, param=QueryParam(mode="bypass"))
    elif any(keyword in query for keyword in ["äº§å“", "åŠŸèƒ½", "ç‰¹æ€§"]):
        return rag.query(query, param=QueryParam(mode="local"))
    elif any(keyword in query for keyword in ["æ¯”è¾ƒ", "åŒºåˆ«", "ä¼˜åŠ¿"]):
        return rag.query(query, param=QueryParam(mode="global"))
    else:
        return rag.query(query, param=QueryParam(mode="hybrid"))

# çŸ¥è¯†é—®ç­”ç³»ç»Ÿ
def knowledge_qa(query: str, complexity: str = "medium"):
    if complexity == "simple":
        return rag.query(query, param=QueryParam(mode="naive"))
    elif complexity == "complex":
        return rag.query(query, param=QueryParam(mode="mix"))
    else:
        return rag.query(query, param=QueryParam(mode="hybrid"))
```

### 5. è°ƒè¯•æŠ€å·§
```python
# å¼€å¯è¯¦ç»†æ—¥å¿—
import logging
logging.getLogger("lightrag").setLevel(logging.DEBUG)

# æŸ¥çœ‹ä¸Šä¸‹æ–‡ä¿¡æ¯
result = rag.query(
    "ä½ çš„æŸ¥è¯¢",
    param=QueryParam(mode="hybrid", only_need_context=True)
)
print("æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡:", result)

# æŸ¥çœ‹ç”Ÿæˆçš„æç¤ºè¯
result = rag.query(
    "ä½ çš„æŸ¥è¯¢",
    param=QueryParam(mode="hybrid", only_need_prompt=True)
)
print("ç”Ÿæˆçš„æç¤ºè¯:", result)
```

è¿™ç§å¤šæ¨¡å¼è®¾è®¡è®©LightRAGèƒ½å¤Ÿæ ¹æ®ä¸åŒçš„æŸ¥è¯¢éœ€æ±‚è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„æ£€ç´¢ç­–ç•¥ï¼Œåœ¨æ€§èƒ½å’Œå‡†ç¡®æ€§ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚é€šè¿‡åˆç†çš„æ¨¡å¼é€‰æ‹©å’Œå‚æ•°è°ƒä¼˜ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚
